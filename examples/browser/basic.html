<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Blobtree - Basic</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                color: #000;
                font-family:Monospace;
                font-size:13px;
                text-align:center;
                font-weight: bold;

                background-color: #fff;
                margin: 0px;
                overflow: hidden;
            }

            #info {
                color:#000;
                position: absolute;
                top: 0px; width: 100%;
                padding: 5px;

            }

            a {
                color: red;
            }
        </style>
    </head>

    <body>
        <div id="info">
            <a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - <a href="https://github.com/dualbox/three-js-blobtree" target="_blank" rel="noopener">Blobtree</a> - Basic example
        </div>

        <script src="../../node_modules/three-full/builds/Three.iife.js"></script>
        <script>
            // Alias to use Three-full as Three
            var THREE = THREE || Three;
        </script>
        <script src="../../dist/browser/blobtree.js"></script>

        <script>

            var camera, controls, scene, renderer;

            init();
            animate();

            function init() {

                scene = new THREE.Scene();
                scene.background = new THREE.Color( 0xf0f0f0 );

                renderer = new THREE.WebGLRenderer( { antialias: true } );
                renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );

                camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
                camera.position.set( 0, 200, 0 );

                // controls

                controls = new THREE.OrbitControls( camera, renderer.domElement );

                //controls.addEventListener( 'change', render ); // call this only in static scenes (i.e., if there is no animation loop)

                controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
                controls.dampingFactor = 0.2;

                controls.screenSpacePanning = false;

                controls.minDistance = 10;
                controls.maxDistance = 1000;

                // Initial Polar angle position
                controls.maxPolarAngle = Math.PI/3;
                controls.minPolarAngle = Math.PI/3;
                controls.update();

                controls.maxPolarAngle = Math.PI;

                controls.rotationSpeed = 0.5;


                // world

                var root = new Blobtree.RootNode();

                root.addChild(
                    new Blobtree.ScalisPoint(
                        new Blobtree.ScalisVertex(
                            new THREE.Vector3(0,0,0),
                            5
                        ),
                        Blobtree.ScalisPrimitive.DIST,
                        1.0,
                        new Blobtree.Material()
                    )
                );

                var smc = new Blobtree.SlidingMarchingCubes(root);

                var geometry = smc.compute();
                //var geometry = new THREE.SphereBufferGeometry( 10 );

                geometry.computeBoundingBox();
                var material = new THREE.MeshPhongMaterial( { color: 0xffffff} );

                var mesh = new THREE.Mesh( geometry, material );
                mesh.updateMatrix();
                mesh.matrixAutoUpdate = false;
                scene.add( mesh );

                // hacked "shadow" (Projection of the geometry on a plane below the object)

                var material =
                scene.add(
                    new THREE.Mesh(
                        geometry.clone().scale(1,0.00001,1).translate(0,-geometry.boundingBox.getSize(new THREE.Vector3()).y/1.5,0),
                        new THREE.MeshBasicMaterial( { color: 0xe0e0e0, side: THREE.DoubleSide } )
                    )
                );

                // lights

                var light = new THREE.DirectionalLight( 0xffffff );
                light.position.set( 1, 1, 1 );
                light.intensity = 0.6
                scene.add( light );
                light = new THREE.DirectionalLight( 0xffffff );
                light.position.set( 1, 1, -1 );
                light.intensity = 0.2;
                scene.add( light );
                light = new THREE.DirectionalLight( 0xffffff );
                light.position.set( -1, -1, -1 );
                light.intensity = 0.4;
                scene.add( light );

                var light = new THREE.AmbientLight( 0x222222 );
                scene.add( light );

                //

                window.addEventListener( 'resize', onWindowResize, false );

            }

            function onWindowResize() {

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize( window.innerWidth, window.innerHeight );

            }

            function animate() {

                requestAnimationFrame( animate );

                controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true

                render();

            }

            function render() {

                renderer.render( scene, camera );

            }

        </script>

    </body>
</html>
